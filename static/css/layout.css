/* ===============================
   Layout — structure & flow only
   =============================== */

/* Embedded right-side panel */
.sidecar-wrapper.sidecar-embedded {
  position: fixed;
  top: 0;
  right: 0;
  height: 100vh;
  width: 380px;
  min-width: 320px;
  max-width: 420px;
  background: #ffffff;
  border-left: 1px solid var(--color-border);
  z-index: 50;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

#ai-assistant-panel.sidecar-embedded {
  width: 360px;
  max-width: 100%;
  height: 100vh;
  display: flex;
  flex-direction: column;
  background: var(--color-surface);
  border-left: 1px solid var(--color-border);
}

/* Inner container */
.sidecar-container {
  height: 100%;
  display: flex;
  flex-direction: column;
}

/* Scrollable content area */
.sidecar-content {
  flex: 1;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  padding: var(--spacing-md);
  padding-bottom: 24px;
}

/* Ensure children never overflow */
.sidecar-content > * {
  max-width: 100%;
}

/* Full page mode */
.sidecar-wrapper.sidecar-fullpage {
  width: 100%;
  min-height: 100vh;
}

/* Section spacing */
.section-card + .section-card {
  margin-top: var(--spacing-lg);
}

.sidecar-content > .section-card {
  margin-bottom: var(--spacing-md);
}

.sidecar-content > .section-card:last-child {
  margin-bottom: 0;
}

/* Header track */
.sidecar-header-track {
  overflow: visible;
  flex: 0 0 auto;
}

/* Collapse functionality */
.sidecar-content:not(.sidecar-header-track) {
  overflow: hidden;
  transition:
    max-height 0.6s cubic-bezier(0.22, 0.61, 0.36, 1),
    transform 0.6s cubic-bezier(0.22, 0.61, 0.36, 1),
    opacity 0.35s ease;
  max-height: 2000px;
  opacity: 1;
  transform-origin: top;
  transform: scaleY(1);
}

.sidecar-collapsed .sidecar-content:not(.sidecar-header-track) {
  max-height: 0;
  opacity: 0;
  transform: scaleY(0);
  pointer-events: none;
}

.sidecar-collapsed .sidecar-header {
  border-bottom: 1px solid rgba(0, 0, 0, 0.06);
}

/* Mobile responsive */
@media (max-width: 480px) {
  .sidecar-content {
    padding: 0;
  }

  .section-card {
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-md);
  }

  .sidecar-header {
    padding: var(--spacing-md);
  }
}
/* ===============================
   SIDECAR SCROLL CONTAINER
   =============================== */

.sidecar-wrapper {
  height: 100%;
  max-height: 100vh;
  display: flex;
  flex-direction: column;
  overflow: hidden; /* important */
}

.sidecar-content {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  padding-bottom: var(--spacing-xl);
  -webkit-overflow-scrolling: touch;
}
/* =====================================================
   COLLAPSE: KEEP HEADER, HIDE BODY (FINAL)
   ===================================================== */
.sidecar-wrapper.sidecar-embedded {
  width: 360px;
  transition: width 0.2s ease;
}

.sidecar-wrapper.sidecar-embedded.sidecar-collapsed {
  width: 64px;
}
/* =====================================================
   COLLAPSE — KEEP HEADER, HIDE ALL BODY (FINAL, CORRECT)
   ===================================================== */

.sidecar-wrapper.sidecar-embedded {
  width: 360px;
  transition: width 0.2s ease;
}

.sidecar-wrapper.sidecar-embedded.sidecar-collapsed {
  width: 64px;
  overflow: hidden;
}

/* Hide ALL sidecar content except header track */
.sidecar-wrapper.sidecar-embedded.sidecar-collapsed .sidecar-content:not(.sidecar-header-track) {
  display: none !important;
}

/* =====================================================
   COLLAPSE — FINAL, FORCE OVERRIDE
   ===================================================== */
.sidecar-wrapper.sidecar-embedded.sidecar-collapsed {
  width: 64px !important;
  min-width: 64px !important;
  max-width: 64px !important;
  overflow: hidden;
}

/* Hide everything except header track */
.sidecar-wrapper.sidecar-embedded.sidecar-collapsed #ai-assistant-panel> :not(.sidecar-header-track) {
  display: none !important;
}