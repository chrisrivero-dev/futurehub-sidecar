<!-- templates/ai_sidecar.html -->
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Sidecar - FutureHub</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/ai_sidecar.css') }}"
    />
  </head>
  <body>
    <!-- Wrapper supports both modes: .sidecar-embedded or .sidecar-fullpage -->
    <div class="sidecar-wrapper sidecar-embedded" id="ai-assistant-panel">
      <div class="sidecar-container">
        <!-- Header -->
        <header class="sidecar-header">
          <div class="header-content">
            <h1>FutureHub Sidecar</h1>
            <span class="header-version">v1.0</span>
          </div>
          <button id="reset-btn" class="btn-icon" title="Reset">
            <svg
              class="icon"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
              />
            </svg>
          </button>
        </header>

        <!-- Scrollable Content -->
        <div class="sidecar-content">
          <!-- Input Form -->
          <section class="section-card">
            <h2 class="section-title">Ticket Information</h2>
            <form id="draft-request-form">
              <div class="form-group">
                <label for="subject">Subject *</label>
                <input
                  type="text"
                  id="subject"
                  name="subject"
                  required
                  maxlength="500"
                  placeholder="Ticket subject"
                />
              </div>

              <div class="form-group">
                <label for="latest-message">Latest Message *</label>
                <textarea
                  id="latest-message"
                  name="latest_message"
                  rows="4"
                  required
                  maxlength="10000"
                  placeholder="Customer's most recent message"
                ></textarea>
              </div>

              <div class="form-group">
                <label for="customer-name">Customer Name</label>
                <input
                  type="text"
                  id="customer-name"
                  name="customer_name"
                  maxlength="100"
                  placeholder="Optional"
                />
              </div>

              <button
                type="submit"
                id="generate-btn"
                class="btn-primary btn-block"
              >
                <svg
                  class="icon"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M13 10V3L4 14h7v7l9-11h-7z"
                  />
                </svg>
                Generate Draft
              </button>
            </form>
          </section>

          <!-- Empty State -->
          <div id="empty-state" class="empty-state">
            <svg
              class="empty-icon"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
              />
            </svg>
            <p>Enter ticket details to generate draft</p>
          </div>

          <!-- Response Container -->
          <div id="response-container" class="hidden">
            <!-- 1. Agent Guidance -->
            <section class="section-card guidance-card">
              <h2 class="section-title">Agent Guidance</h2>
              <div id="guidance-badges" class="badge-row"></div>
              <div class="guidance-content">
                <div class="guidance-item">
                  <span class="label">Reason:</span>
                  <span id="guidance-reason" class="value"></span>
                </div>
                <div class="guidance-item">
                  <span class="label">Recommendation:</span>
                  <span id="guidance-recommendation" class="value"></span>
                </div>
              </div>
            </section>

            <!-- 2. Confidence & Risk -->
            <section class="section-card">
              <h2 class="section-title">Confidence & Risk</h2>
              <div class="metrics-stack">
                <div class="metric-row">
                  <span class="metric-label">Confidence</span>
                  <div class="metric-value">
                    <span
                      id="confidence-percentage"
                      class="metric-number"
                    ></span>
                    <span id="confidence-label" class="metric-badge"></span>
                  </div>
                </div>
                <div class="metric-row">
                  <span class="metric-label">Safety Mode</span>
                  <span id="safety-mode" class="metric-badge"></span>
                </div>
                <div class="metric-row">
                  <span class="metric-label">Ambiguity</span>
                  <span id="ambiguity-status" class="metric-badge"></span>
                </div>
              </div>
              <div class="metric-explainer">
                <p><strong>Confidence</strong> — How certain the AI is that this response matches the customer’s intent.</p>
                <p><strong>Safety</strong> — Whether the response is safe to send without policy or risk concerns.</p>
                <p><strong>Ambiguity</strong> — Indicates unclear or incomplete customer information.</p>
              </div>

            </section>

            <!-- 3. Intent Classification -->
            <section class="section-card">
              <h2 class="section-title">Intent Classification</h2>
              <div class="intent-content">
                <div class="intent-primary-row">
                  <span class="label-xs">Primary</span>
                  <div id="primary-intent" class="intent-chip-primary"></div>
                </div>
                <div id="secondary-intents-container" class="hidden">
                  <span class="label-xs">Secondary</span>
                  <div id="secondary-intents" class="intent-chips"></div>
                </div>
              </div>
            </section>
            <!-- 4. Draft Response -->
            <section class="section-card">
              <div class="section-header">
                <h2 class="section-title">Draft Response</h2>
              </div>
            
              <textarea id="draft-text" class="draft-textarea" rows="8"></textarea>
            
              <button id="insert-draft-btn" class="btn-secondary btn-block btn-sm">
                Insert into Reply
              </button>
            </section>


            <!-- 5. Suggested Actions -->
            <section class="section-card">
              <h2 class="section-title">Suggested Actions</h2>
              <ol id="suggested-actions-list" class="actions-list"></ol>
            </section>

            <!-- 6. Canned Responses -->
            <section class="section-card">
              <h3 class="section-title">Canned Responses</h3>

              <div class="canned-dropdown">
                <button
                  id="canned-dropdown-btn"
                  class="btn-secondary btn-block canned-dropdown-trigger"
                  type="button"
                  aria-expanded="false"
                >
                  <span>Select a canned response…</span>
                  <svg
                    class="dropdown-caret"
                    viewBox="0 0 20 20"
                    fill="currentColor"
                  >
                    <path d="M5.5 7.5L10 12l4.5-4.5" />
                  </svg>
                </button>

                <div
                  id="canned-dropdown-menu"
                  class="canned-dropdown-menu hidden"
                  role="menu"
                  aria-label="Canned responses"
                ></div>
              </div>

              <p class="help-text">
                Select a response to insert it into the draft. ★ indicates
                AI-recommended responses.
              </p>
            </section>

            <!-- 7. Knowledge Base Search -->
            <section class="section-card">
              <h2 class="section-title">Knowledge Base</h2>
              <p class="help-text">Search integration coming soon</p>
            </section>

            <!-- 8. Conversation Context -->
            <section class="section-card">
              <h2 class="section-title">Conversation Context</h2>
              <div id="conversation-messages"></div>
            </section>
          </div>
        </div>
      </div>
    </div>

    <div id="toast" class="toast hidden"></div>
    <script src="{{ url_for('static', filename='js/ai_sidecar.js') }}"></script>
  </body>
</html>
