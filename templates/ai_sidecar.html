<!-- templates/ai_sidecar.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Sidecar - FutureHub</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/ai_sidecar.css') }}"
    />
  </head>
  <body>
    <!-- Wrapper supports both modes: .sidecar-embedded or .sidecar-fullpage -->
    <div class="sidecar-wrapper sidecar-fullpage">
      <div class="sidecar-container">
        <!-- Header -->
        <header class="sidecar-header">
          <div class="header-content">
            <h1>FutureHub Sidecar</h1>
            <span class="header-version">v1.0</span>
          </div>
          <button id="reset-btn" class="btn-icon" title="Reset">
            <svg
              class="icon"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
              />
            </svg>
          </button>
        </header>

        <!-- Scrollable Content -->
        <div class="sidecar-content">
          <!-- Input Form -->
          <section class="section-card">
            <h2 class="section-title">Ticket Information</h2>
            <form id="draft-request-form">
              <div class="form-group">
                <label for="subject">Subject *</label>
                <input
                  type="text"
                  id="subject"
                  name="subject"
                  required
                  maxlength="500"
                  placeholder="Ticket subject"
                />
              </div>
              <div class="form-group">
                <label for="latest-message">Latest Message *</label>
                <textarea
                  id="latest-message"
                  name="latest_message"
                  rows="4"
                  required
                  maxlength="10000"
                  placeholder="Customer's most recent message"
                ></textarea>
              </div>
              <div class="form-group">
                <label for="customer-name">Customer Name</label>
                <input
                  type="text"
                  id="customer-name"
                  name="customer_name"
                  maxlength="100"
                  placeholder="Optional"
                />
              </div>
              <button
                type="submit"
                id="generate-btn"
                class="btn-primary btn-block"
              >
                <svg
                  class="icon"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M13 10V3L4 14h7v7l9-11h-7z"
                  />
                </svg>
                Generate Draft
              </button>
            </form>
          </section>

          <!-- Empty State -->
          <div id="empty-state" class="empty-state">
            <svg
              class="empty-icon"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
              />
            </svg>
            <p>Enter ticket details to generate draft</p>
          </div>

          <!-- Response Container -->
          <div id="response-container" class="hidden">
            <!-- 1. Agent Guidance -->
            <section class="section-card guidance-card">
              <h2 class="section-title">Agent Guidance</h2>
              <div id="guidance-badges" class="badge-row"></div>
              <div class="guidance-content">
                <div class="guidance-item">
                  <span class="label">Reason:</span>
                  <span id="guidance-reason" class="value"></span>
                </div>
                <div class="guidance-item">
                  <span class="label">Recommendation:</span>
                  <span id="guidance-recommendation" class="value"></span>
                </div>
              </div>
            </section>

            <!-- 2. Confidence & Risk -->
            <section class="section-card">
              <h2 class="section-title">Confidence & Risk</h2>
              <div class="metrics-stack">
                <div class="metric-row">
                  <span class="metric-label">Confidence</span>
                  <div class="metric-value">
                    <span id="confidence-percentage" class="metric-number"
                      >--</span
                    >
                    <span id="confidence-label" class="metric-badge"></span>
                  </div>
                </div>
                <div class="metric-row">
                  <span class="metric-label">Safety Mode</span>
                  <span id="safety-mode" class="metric-badge"></span>
                </div>
                <div class="metric-row">
                  <span class="metric-label">Ambiguity</span>
                  <span id="ambiguity-status" class="metric-badge"></span>
                </div>
              </div>
            </section>

            <!-- 3. Intent Classification -->
            <section class="section-card">
              <h2 class="section-title">Intent Classification</h2>
              <div class="intent-content">
                <div class="intent-primary-row">
                  <span class="label-xs">Primary</span>
                  <div id="primary-intent" class="intent-chip-primary"></div>
                </div>
                <div id="secondary-intents-container" class="hidden">
                  <span class="label-xs">Secondary</span>
                  <div id="secondary-intents" class="intent-chips"></div>
                </div>
                <div id="device-behavior-alert" class="hidden alert-warning">
                  <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
                    <path
                      fill-rule="evenodd"
                      d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                      clip-rule="evenodd"
                    />
                  </svg>
                  Device behavior detected
                </div>
                <div id="attempted-actions-container" class="hidden">
                  <span class="label-xs">Attempted Actions</span>
                  <span id="attempted-actions" class="text-sm"></span>
                </div>
              </div>
            </section>

            <!-- 4. Draft Response -->
            <section class="section-card">
              <div class="section-header">
                <h2 class="section-title">Draft Response</h2>
                <div class="section-controls">
                  <span id="draft-type-badge" class="badge"></span>
                  <button
                    id="copy-draft-btn"
                    class="btn-icon btn-sm"
                    title="Copy draft"
                  >
                    <svg
                      class="icon"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
                      />
                    </svg>
                  </button>
                </div>
              </div>
              <textarea
                id="draft-text"
                class="draft-textarea"
                rows="8"
              ></textarea>
              <button
                id="insert-draft-btn"
                class="btn-secondary btn-block btn-sm"
              >
                <svg
                  class="icon"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
                  />
                </svg>
                Insert into Reply
              </button>
            </section>

            <!-- 5. Suggested Actions -->
            <section class="section-card">
              <button class="section-toggle" id="toggle-actions">
                <h2 class="section-title">Suggested Actions</h2>
                <svg
                  class="icon toggle-icon"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 9l-7 7-7-7"
                  />
                </svg>
              </button>
              <div id="actions-content" class="collapsible-content">
                <ol id="suggested-actions-list" class="actions-list"></ol>
              </div>
            </section>

            <!-- 6. Quick Replies -->
            <section class="section-card">
              <h2 class="section-title">Quick Replies</h2>
              <div id="canned-response-container" class="hidden">
                <button id="canned-response-btn" class="quick-reply-btn">
                  <svg
                    class="icon"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M5 13l4 4L19 7"
                    />
                  </svg>
                  <span id="canned-response-text"></span>
                </button>
              </div>
              <div class="quick-replies-placeholder">
                <button class="quick-reply-btn" disabled>
                  Request Order Number
                </button>
                <button class="quick-reply-btn" disabled>
                  Request Debug Logs
                </button>
                <button class="quick-reply-btn" disabled>
                  Setup Instructions
                </button>
              </div>
              <p class="help-text">Knowledge-based replies (placeholder)</p>
            </section>

            <!-- 7. Knowledge Base Search -->
            <section class="section-card">
              <h2 class="section-title">Knowledge Base</h2>
              <div class="search-input-group">
                <input
                  type="text"
                  id="kb-search-input"
                  placeholder="Search articles..."
                  disabled
                />
                <button class="btn-icon btn-sm" disabled>
                  <svg
                    class="icon"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                    />
                  </svg>
                </button>
              </div>
              <div class="kb-results">
                <p class="help-text">Search integration coming soon</p>
              </div>
            </section>

            <!-- 8. Conversation Context -->
            <section class="section-card">
              <button class="section-toggle collapsed" id="toggle-context">
                <h2 class="section-title">Conversation Context</h2>
                <svg
                  class="icon toggle-icon"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 9l-7 7-7-7"
                  />
                </svg>
              </button>
              <div id="context-content" class="collapsible-content collapsed">
                <div
                  id="conversation-messages"
                  class="conversation-thread"
                ></div>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>

    <div id="toast" class="toast hidden"></div>
    <script src="{{ url_for('static', filename='js/ai_sidecar.js') }}"></script>
  </body>
</html>
